example_batch:
  dag_id: example_batch
  params: {}
  default_args:
    start_date: '2026-01-01'
  schedule: '@once'
  tasks:
    create_compute_environment:
      operator: airflow.providers.amazon.aws.operators.batch.BatchCreateComputeEnvironmentOperator
      aws_conn_id: aws_default
      compute_environment_name: test-test-job-compute-environment
      compute_resources:
        type: FARGATE
        maxvCpus: 10
        securityGroupIds: test
        subnets: test
      deferrable: false
      environment_type: MANAGED
      max_retries: 120
      outlets: []
      params: {}
      poll_interval: 30
      priority_weight: 1
      retries: 0
      retry_delay: 300.0
      retry_exponential_backoff: false
      state: ENABLED
      tags: {}
      task_id: create_compute_environment
      trigger_rule: all_success
      wait_for_downstream: false
      dependencies: [create_job_definition]
    wait_for_compute_environment_valid:
      operator: airflow.providers.amazon.aws.sensors.batch.BatchComputeEnvironmentSensor
      aws_conn_id: aws_default
      compute_environment: test-test-job-compute-environment
      mode: poke
      outlets: []
      params: {}
      poke_interval: 1
      priority_weight: 1
      retries: 0
      retry_delay: 300.0
      retry_exponential_backoff: false
      task_id: wait_for_compute_environment_valid
      timeout: 604800.0
      trigger_rule: all_success
      wait_for_downstream: false
      dependencies: [create_compute_environment]
    wait_for_job_queue_valid:
      operator: airflow.providers.amazon.aws.sensors.batch.BatchJobQueueSensor
      aws_conn_id: aws_default
      job_queue: test-test-job-queue
      mode: poke
      outlets: []
      params: {}
      poke_interval: 1
      priority_weight: 1
      retries: 0
      retry_delay: 300.0
      retry_exponential_backoff: false
      task_id: wait_for_job_queue_valid
      timeout: 604800.0
      treat_non_existing_as_deleted: false
      trigger_rule: all_success
      wait_for_downstream: false
      dependencies: [create_job_queue]
    submit_batch_job:
      operator: airflow.providers.amazon.aws.operators.batch.BatchOperator
      aws_conn_id: aws_default
      awslogs_enabled: false
      awslogs_fetch_interval: 30.0
      container_overrides: {}
      deferrable: false
      job_definition: test-test-job-definition
      job_name: test-test-job
      job_queue: test-test-job-queue
      max_retries: 4200
      outlets: []
      parameters: {}
      params: {}
      poll_interval: 30
      priority_weight: 1
      retries: 0
      retry_delay: 300.0
      retry_exponential_backoff: false
      tags: {}
      task_id: submit_batch_job
      trigger_rule: all_success
      wait_for_completion: false
      wait_for_downstream: false
      dependencies: [wait_for_job_queue_valid]
    wait_for_batch_job:
      operator: airflow.providers.amazon.aws.sensors.batch.BatchSensor
      aws_conn_id: aws_default
      deferrable: false
      job_id: '{{ task_instance.xcom_pull(task_ids=''submit_batch_job'', key=''return_value'')
        }}'
      max_retries: 4200
      mode: poke
      outlets: []
      params: {}
      poke_interval: 10
      priority_weight: 1
      retries: 0
      retry_delay: 300.0
      retry_exponential_backoff: false
      task_id: wait_for_batch_job
      timeout: 604800.0
      trigger_rule: all_success
      wait_for_downstream: false
      dependencies: [submit_batch_job]
    wait_for_compute_environment_disabled:
      operator: airflow.providers.amazon.aws.sensors.batch.BatchComputeEnvironmentSensor
      aws_conn_id: aws_default
      compute_environment: test-test-job-compute-environment
      mode: poke
      outlets: []
      params: {}
      poke_interval: 1
      priority_weight: 1
      retries: 0
      retry_delay: 300.0
      retry_exponential_backoff: false
      task_id: wait_for_compute_environment_disabled
      timeout: 604800.0
      trigger_rule: all_success
      wait_for_downstream: false
      dependencies: [disable_compute_environment]
    wait_for_job_queue_modified:
      operator: airflow.providers.amazon.aws.sensors.batch.BatchJobQueueSensor
      aws_conn_id: aws_default
      job_queue: test-test-job-queue
      mode: poke
      outlets: []
      params: {}
      poke_interval: 1
      priority_weight: 1
      retries: 0
      retry_delay: 300.0
      retry_exponential_backoff: false
      task_id: wait_for_job_queue_modified
      timeout: 604800.0
      treat_non_existing_as_deleted: false
      trigger_rule: all_success
      wait_for_downstream: false
      dependencies: [disable_job_queue]
    wait_for_job_queue_deleted:
      operator: airflow.providers.amazon.aws.sensors.batch.BatchJobQueueSensor
      aws_conn_id: aws_default
      job_queue: test-test-job-queue
      mode: poke
      outlets: []
      params: {}
      poke_interval: 10
      priority_weight: 1
      retries: 0
      retry_delay: 300.0
      retry_exponential_backoff: false
      task_id: wait_for_job_queue_deleted
      timeout: 604800.0
      treat_non_existing_as_deleted: true
      trigger_rule: all_success
      wait_for_downstream: false
      dependencies: [delete_job_queue]
    deregister_task:
      operator: airflow.providers.amazon.aws.operators.ecs.EcsDeregisterTaskDefinitionOperator
      aws_conn_id: aws_default
      outlets: []
      params: {}
      priority_weight: 1
      retries: 0
      retry_delay: 300.0
      retry_exponential_backoff: false
      task_definition: test-test-job-definition:1
      task_id: deregister_task
      trigger_rule: all_done
      wait_for_downstream: false
      dependencies: [delete_job_definition]
    create_job_definition:
      outlets: []
      params: {}
      priority_weight: 1
      python_callable: airflow_batch.create_job_definition
      retries: 0
      retry_delay: 300.0
      retry_exponential_backoff: false
      task_id: create_job_definition
      trigger_rule: all_success
      wait_for_downstream: false
      dependencies: []
      decorator: airflow.decorators.task
      role_arn: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
      job_definition_name: test-test-job-definition
    create_job_queue:
      outlets: []
      params: {}
      priority_weight: 1
      python_callable: airflow_batch.create_job_queue
      retries: 0
      retry_delay: 300.0
      retry_exponential_backoff: false
      task_id: create_job_queue
      trigger_rule: all_success
      wait_for_downstream: false
      dependencies: [wait_for_compute_environment_valid]
      decorator: airflow.decorators.task
      job_compute_environment_name: test-test-job-compute-environment
      job_queue_name: test-test-job-queue
    describe_job:
      outlets: []
      params: {}
      priority_weight: 1
      python_callable: airflow_batch.describe_job
      retries: 0
      retry_delay: 300.0
      retry_exponential_backoff: false
      task_id: describe_job
      trigger_rule: one_failed
      wait_for_downstream: false
      dependencies: [wait_for_batch_job, submit_batch_job]
      decorator: airflow.decorators.task
      job_id: +submit_batch_job
    disable_job_queue:
      outlets: []
      params: {}
      priority_weight: 1
      python_callable: airflow_batch.disable_job_queue
      retries: 0
      retry_delay: 300.0
      retry_exponential_backoff: false
      task_id: disable_job_queue
      trigger_rule: all_done
      wait_for_downstream: false
      dependencies: [describe_job]
      decorator: airflow.decorators.task
      job_queue_name: test-test-job-queue
    delete_job_queue:
      outlets: []
      params: {}
      priority_weight: 1
      python_callable: airflow_batch.delete_job_queue
      retries: 0
      retry_delay: 300.0
      retry_exponential_backoff: false
      task_id: delete_job_queue
      trigger_rule: all_done
      wait_for_downstream: false
      dependencies: [wait_for_job_queue_modified]
      decorator: airflow.decorators.task
      job_queue_name: test-test-job-queue
    disable_compute_environment:
      outlets: []
      params: {}
      priority_weight: 1
      python_callable: airflow_batch.disable_compute_environment
      retries: 0
      retry_delay: 300.0
      retry_exponential_backoff: false
      task_id: disable_compute_environment
      trigger_rule: all_done
      wait_for_downstream: false
      dependencies: [wait_for_job_queue_deleted]
      decorator: airflow.decorators.task
      job_compute_environment_name: test-test-job-compute-environment
    delete_compute_environment:
      outlets: []
      params: {}
      priority_weight: 1
      python_callable: airflow_batch.delete_compute_environment
      retries: 0
      retry_delay: 300.0
      retry_exponential_backoff: false
      task_id: delete_compute_environment
      trigger_rule: all_done
      wait_for_downstream: false
      dependencies: [wait_for_compute_environment_disabled]
      decorator: airflow.decorators.task
      job_compute_environment_name: test-test-job-compute-environment
    delete_job_definition:
      outlets: []
      params: {}
      priority_weight: 1
      python_callable: airflow_batch.delete_job_definition
      retries: 0
      retry_delay: 300.0
      retry_exponential_backoff: false
      task_id: delete_job_definition
      trigger_rule: all_done
      wait_for_downstream: false
      dependencies: [delete_compute_environment]
      decorator: airflow.decorators.task
      job_definition_name: test-test-job-definition
